<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Detective - GPU-Powered Local AI Video Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-search"></i>
                    <h1>AI Video Detective</h1>
                </div>
                <p class="subtitle">GPU-Powered Local AI Video Analysis (7B Model Only)</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-section="upload">
                <i class="fas fa-folder"></i>
                Upload & Analyze
            </button>
            <button class="nav-btn" data-section="chat">
                <i class="fas fa-comments"></i>
                AI Chat
            </button>
            <button class="nav-btn" data-section="streaming">
                <i class="fas fa-video"></i>
                Real-Time Streaming
            </button>
            <button class="nav-btn" data-section="sessions">
                <i class="fas fa-chart-bar"></i>
                Sessions
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload & Analyze Section -->
            <section id="upload" class="section active">
                <div class="section-header">
                    <h2><i class="fas fa-folder"></i> Upload & Analyze Video</h2>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div class="upload-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <h3>Drop your video here</h3>
                        <p>or click to browse</p>
                        <input type="file" id="videoFile" accept="video/*" style="display: none;">
                    </div>
                </div>

                <!-- Model Selection -->
                <div class="model-selection">
                    <label class="model-label">
                        <i class="fas fa-brain"></i>
                        AI Model Selection
                    </label>
                    <select id="modelSelect" class="model-select">
                        <option value="minicpm">MiniCPM - Fast & Efficient</option>
                        <option value="qwen25vl">Qwen2.5-VL - Advanced Multimodal</option>
                        <option value="qwen25vl_32b">Qwen2.5-VL 32B - High Performance</option>
                    </select>
                    <div class="model-info" id="modelInfo">
                        <small>Select an AI model for video analysis</small>
                    </div>
                </div>

                <!-- File Info -->
                <div class="file-info" id="fileInfo" style="display: none;">
                    <div class="file-card">
                        <div class="file-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="file-details">
                            <div class="file-name" id="fileName"></div>
                            <div class="file-size" id="fileSize"></div>
                        </div>
                        <button class="file-remove" onclick="resetUpload()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Video Preview -->
                <div class="video-preview" id="videoPreview" style="display: none;">
                    <div class="preview-container">
                        <div class="preview-header">
                            <h3>Video Preview</h3>
                            <p>Review your video before analysis</p>
                        </div>
                        <div class="video-container">
                            <video id="previewVideo" controls preload="metadata"></video>
                        </div>
                        <div class="preview-actions">
                            <button class="preview-btn primary" onclick="uploadSelectedVideo()">
                                <i class="fas fa-play"></i>
                                Start Analysis
                            </button>
                            <button class="preview-btn secondary" onclick="resetUpload()">
                                <i class="fas fa-undo"></i>
                                Choose Different Video
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upload Progress -->
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                        <div class="progress-text">Uploading video...</div>
                    </div>
                </div>

                <!-- Analysis Options -->
                <div class="analysis-options" id="analysisOptions" style="display: none;">
                    <h3>Analysis Options</h3>
                    <div class="option-group">
                        <label>Analysis Type:</label>
                        <select id="analysisType">
                            <option value="content">Content Analysis</option>
                            <option value="objects">Object Detection</option>
                            <option value="actions">Action Recognition</option>
                            <option value="scenes">Scene Analysis</option>
                            <option value="narrative">Narrative Analysis</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label>Focus Area:</label>
                        <input type="text" id="userFocus" placeholder="What should I focus on? (optional)">
                    </div>
                    <button class="analyze-btn" onclick="analyzeVideo()">
                        <i class="fas fa-search"></i>
                        Analyze Video
                    </button>
                </div>
            </section>

            <!-- AI Chat Section -->
            <section id="chat" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> AI Chat</h2>
                </div>
                
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai">
                            <div class="message-content">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-text">
                                    Hello! I'm your AI video analysis assistant. I can help you understand video content, answer questions, and provide insights. What would you like to know?
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <div class="typing-content">
                            <div class="typing-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="typing-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <div class="input-container">
                                <textarea 
                                    id="chatInput" 
                                    class="chat-input" 
                                    placeholder="Ask me about the video..."
                                    disabled
                                ></textarea>
                                <button id="sendBtn" class="send-button" onclick="sendMessage()" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="input-footer">
                                <div class="input-hint">Press Enter to send, Shift+Enter for new line</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Real-Time Streaming Section -->
            <section id="streaming" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-video"></i> Real-Time Video Streaming</h2>
                </div>
                
                <p class="section-description">
                    Stream video in real-time with live 7B model analysis. Analyze live feeds, camera streams, or video files with instant AI insights.
                </p>
                
                <div class="streaming-toggle">
                    <button class="toggle-btn" onclick="toggleStreamingInterface()">
                        <i class="fas fa-rocket"></i>
                        Enable Streaming Interface
                    </button>
                </div>
                
                <div class="streaming-section hidden" id="streamingInterface">
                    <h3><i class="fas fa-video"></i> Real-Time Video Streaming</h3>
                    
                    <div class="connection-status disconnected" id="connectionStatus">
                        <i class="fas fa-circle"></i>
                        WebSocket Disconnected
                    </div>
                    
                    <div class="stream-controls">
                        <input type="text" id="streamId" placeholder="Stream ID (e.g., camera1)" value="camera1">
                        <input type="text" id="videoSource" placeholder="Video Source (0 for camera, file path, or URL)" value="0">
                        <button onclick="startStream()">Start Stream</button>
                        <button onclick="stopStream()">Stop Stream</button>
                    </div>
                    
                    <div class="stream-status">
                        <div class="status-card">
                            <h4>Current FPS</h4>
                            <div class="value" id="currentFps">0.0</div>
                        </div>
                        <div class="status-card">
                            <h4>Target FPS</h4>
                            <div class="value" id="targetFps">30</div>
                        </div>
                        <div class="status-card">
                            <h4>Latency</h4>
                            <div class="value" id="currentLatency">0ms</div>
                        </div>
                        <div class="status-card">
                            <h4>Events Detected</h4>
                            <div class="value" id="eventsCount">0</div>
                        </div>
                        <div class="status-card">
                            <h4>AI Analyses</h4>
                            <div class="value" id="aiAnalysisCount">0</div>
                        </div>
                    </div>
                    
                    <div class="stream-video">
                        <video id="streamVideo" autoplay muted></video>
                    </div>
                    
                    <div class="stream-events">
                        <h4><i class="fas fa-chart-bar"></i> Live Events & AI Analysis</h4>
                        <div id="streamEventsList">
                            <p style="text-align: center; opacity: 0.7;">No events detected yet. Start a stream to see live analysis.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sessions Section -->
            <section id="sessions" class="section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Analysis Sessions</h2>
                </div>
                
                <div class="sessions-container">
                    <div class="session-controls">
                        <button onclick="refreshSessions()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                        <button onclick="cleanupSessions()">
                            <i class="fas fa-broom"></i>
                            Cleanup
                        </button>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <p>Loading sessions...</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Loading Modal -->
    <div class="loading-modal" id="loadingModal" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
            </div>
            <div class="loading-text">
                <h3 id="loadingMessage">Processing...</h3>
                <p>Please wait while we analyze your video</p>
            </div>
            <div class="loading-steps">
                <div class="step active">
                    <i class="fas fa-upload"></i>
                    <span>Upload</span>
                </div>
                <div class="step">
                    <i class="fas fa-cog"></i>
                    <span>Processing</span>
                </div>
                <div class="step">
                    <i class="fas fa-brain"></i>
                    <span>AI Analysis</span>
                </div>
                <div class="step">
                    <i class="fas fa-check"></i>
                    <span>Complete</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Evidence Modal -->
    <div class="evidence-modal" id="evidenceModal" style="display: none;">
        <div class="evidence-content">
            <div class="evidence-header">
                <h3>Visual Evidence</h3>
                <button class="close-btn" onclick="closeEvidenceModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="evidence-body">
                <img id="evidenceModalImage" src="" alt="Evidence">
                <div class="evidence-info" id="evidenceModalInfo"></div>
            </div>
        </div>
    </div>

    <!-- Floating Cleanup Button -->
    <div class="floating-cleanup" id="floatingCleanup" style="display: none;">
        <button class="cleanup-btn" onclick="cleanupSession()">
            <i class="fas fa-broom"></i>
            Cleanup Session
        </button>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html> 